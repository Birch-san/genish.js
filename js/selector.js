'use strict'

let gen = require( './gen.js' )

let proto = {
  basename:'selector',

  gen() {
    let inputs = gen.getInputs( this ), out, returnValue = 0

    gen.variableNames.add( [ this.name+'_out', 'f' ] )
    
    switch( inputs.length ) {
      case 2 :
        returnValue = inputs[1]
        break;
      case 3 :
        out = `  ${this.name}_out = fround(${inputs[0]}|0) == 1 ? fround(${inputs[1]}) : fround(${inputs[2]})\n\n`;
        returnValue = [ this.name + '_out', out ]
        break;  
      default:
        out = 
` ${this.name}_out = fround(0)
  switch( ~~floor( +${inputs[0]} + 1.0 ) |0 ) {\n`

        for( let i = 1; i < inputs.length; i++ ){
          out +=`    case ${i}: ${this.name}_out = fround(${inputs[i]}); break;\n` 
        }

        out += '  }\n\n'
        
        returnValue = [ this.name + '_out', ' ' + out ]
    }

    return returnValue
  },
}

module.exports = ( ...inputs ) => {
  let ugen = Object.create( proto )
  
  Object.assign( ugen, {
    uid:     gen.getUID(),
    inputs
  })
  
  ugen.name = `${ugen.basename}${ugen.uid}`

  return ugen
}
